/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.viz.ui5.controls.VizFrame");jQuery.sap.require("sap.viz.library");jQuery.sap.require("sap.viz.ui5.controls.common.BaseControl");sap.viz.ui5.controls.common.BaseControl.extend("sap.viz.ui5.controls.VizFrame",{metadata:{publicMethods:["getVizUid","vizUpdate","vizSelection","getResponsiveLegend"],library:"sap.viz",properties:{"vizType":{type:"string",group:"Misc",defaultValue:null},"vizProperties":{type:"object",group:"Misc",defaultValue:null},"vizScales":{type:"object",group:"Misc",defaultValue:null}},aggregations:{"dataset":{type:"sap.viz.ui5.data.Dataset",multiple:false},"feeds":{type:"sap.viz.ui5.controls.common.feeds.FeedItem",multiple:true,singularName:"feed"}},events:{"renderComplete":{},"selectData":{},"deselectData":{}}}});sap.viz.ui5.controls.VizFrame.M_EVENTS={'renderComplete':'renderComplete','selectData':'selectData','deselectData':'deselectData'};jQuery.sap.require("sap.viz.ui5.controls.libs.sap-viz-controls");jQuery.sap.require("sap.viz.ui5.controls.common.feeds.AnalysisObject");jQuery.sap.require("sap.viz.ui5.controls.common.feeds.FeedItem");jQuery.sap.require("sap.viz.ui5.controls.common.helpers.VizControlsHelper");jQuery.sap.require("sap.viz.ui5.controls.ResponsiveLegend");jQuery.sap.require("sap.viz.ui5.theming.Util");
sap.viz.ui5.controls.VizFrame.prototype.init=function(){sap.viz.ui5.controls.common.BaseControl.prototype.init.apply(this,arguments);this._vizFrame=null;this._onThemeChanged=jQuery.proxy(this._applyTheme,this);sap.ui.getCore().attachThemeChanged(this._onThemeChanged);this._clearVariables();this._requestedVizType='info/column'};
sap.viz.ui5.controls.VizFrame.prototype.applySettings=function(){sap.ui.core.Control.prototype.applySettings.apply(this,arguments);if(!this._vizFrame){this._createVizFrame()}};
sap.viz.ui5.controls.VizFrame.prototype.exit=function(){sap.viz.ui5.controls.common.BaseControl.prototype.exit.apply(this,arguments);sap.ui.getCore().detachThemeChanged(this._onThemeChanged);this._clearVariables()};
sap.viz.ui5.controls.VizFrame.prototype._clearVariables=function(){this._vizFrame$=null;this._vizCreated=false;this._clearRequestedProperties();this._cachedDataset=null};
sap.viz.ui5.controls.VizFrame.prototype._clearRequestedProperties=function(){this._requestedVizType=null;this._requestedVizProperties=null;this._requestedVizScales=null;var f=this.getAggregation('feeds');if(f&&this._vizFrame&&this._vizCreated){var v=this._getVizType();var i=this._vizFrame.feeds();f.forEach(function(a){a.setProperty('uid',sap.viz.api.serialization.feedsIdToBindingId(v,a.getUid())||a.getUid(),true);var b=a.getAnalysisObjects();var c=[],r=false;i.forEach(function(d){if(a.getUid()===d.id()){r=r||a.getValues().length!==d.values().length;d.values().forEach(function(e,g){r=r||b[g].getUid()!==e.id();c.push(e.id())})}}.bind(this));if(r){a.setProperty('values',c,true)}}.bind(this))}};
sap.viz.ui5.controls.VizFrame.prototype.getVizUid=function(){if(this._vizFrame){return this._vizFrame.vizUid()}else{return null}};
sap.viz.ui5.controls.VizFrame.prototype.setUiConfig=function(u){sap.viz.ui5.controls.common.BaseControl.prototype.setUiConfig.apply(this,arguments)};
sap.viz.ui5.controls.VizFrame.prototype.getVizType=function(){var v=this._getVizType();if(v.indexOf('info/')===0){v=v.substr('info/'.length)}return v};
sap.viz.ui5.controls.VizFrame.prototype._getVizType=function(){var v;if(this._vizFrame&&this._vizFrame.vizType()){v=this._requestedVizType||this._vizFrame.vizType()}else{v=this._requestedVizType}v=v||'';v=v.replace('/trellis_','/');return v};
sap.viz.ui5.controls.VizFrame.prototype.setVizType=function(v){var p='info/';if(sap.viz.ui5.controls.VizFrame._isNativeVizType(p+v)){v=p+v}if(this._vizFrame&&this._vizCreated&&!this._pendingRerendering){try{this._vizFrame.vizType(v)}catch(e){this._requestedVizType=v}}else{this._requestedVizType=v}return this};
sap.viz.ui5.controls.VizFrame.prototype.getVizProperties=function(){if(this._vizFrame){return this._mergeProperties(this._mergeProperties({},this._vizFrame.vizProperties()||{}),this._requestedVizProperties||{})}else{return this._requestedVizProperties}};
sap.viz.ui5.controls.VizFrame.prototype.getVizScales=function(){if(this._vizFrame){return this._vizFrame.vizScales()||this._requestedVizScales}else{return this._requestedVizScales}};
sap.viz.ui5.controls.VizFrame.prototype.setVizProperties=function(v){if(this._vizFrame&&this._vizCreated&&!this._pendingRerendering){try{this._vizFrame.vizProperties(v)}catch(e){this._requestedVizProperties=v}}else{this._requestedVizProperties=this._mergeProperties(this._requestedVizProperties||{},v||{});this.invalidate()}return this};
sap.viz.ui5.controls.VizFrame.prototype.setVizScales=function(v){if(this._vizFrame&&this._vizCreated&&!this._pendingRerendering){try{this._vizFrame.vizScales(v)}catch(e){this._requestedVizScales=v}}else{this._requestedVizScales=jQuery.extend(true,this._requestedVizScales||{},v||{});this.invalidate()}return this};
sap.viz.ui5.controls.VizFrame.prototype.vizSelection=function(p,a){if(this._vizFrame&&this._vizCreated){try{var r=this._vizFrame.vizSelection.apply(this._vizFrame,arguments);if(r===this._vizFrame){r=this}}catch(e){return null}return r}else{return null}};
sap.viz.ui5.controls.VizFrame.prototype.vizUpdate=function(o){if(this._vizFrame){if(o.data||o.feeds){if(o.properties){this._requestedVizProperties=this._mergeProperties(this._requestedVizProperties||{},o.properties||{})}if(o.properties){this._requestedVizScales=jQuery.extend(true,this._requestedVizScales||{},o.scales||{})}if(o.data){this.setDataset(o.data)}if(o.feeds){this._setFeeds(o.feeds)}}else{this._vizFrame.vizUpdate(o)}}};
sap.viz.ui5.controls.VizFrame.prototype.getResponsiveLegend=function(){if(this._vizFrame){return sap.viz.ui5.controls.ResponsiveLegend.createInstance(this._vizFrame.responsiveLegend())}};
sap.viz.ui5.controls.VizFrame.prototype._createVizFrame=function(o){this._applyTheme();var V=sap.viz.controls.frame.VizFrame;var G=sap.viz.controls.common.config.GlobalConfig;var c='ui5-viz-controls';this._vizFrame$=jQuery(document.createElement('div'));this._vizFrame$.addClass(c+'-viz-frame');var v=G.defaultUIConfig(G.DEFAULT_UICONFIG_TYPE_FRAME);v.enableContextMenu=false;v.enableFilterMenu=false;v.enableFilterBar=false;v.enableTitleEditor=false;v.enableSettingButton=false;v.enableFullScreenButton=false;v.enablePlayControl=false;v.controls.chart.enableMorphing=false;v.controls.chart.enableTrellis=true;v.controls.contextMenu.menu=[["direction","stacking"],["legend","datalabels"]];var u=this.getUiConfig();if(u){if(u.applicationSet==='fiori'){v.enableResponsiveLegend=true;v.controls.chart.defaultLabelFormatString=null;this._mergeProperties(v.controls.chart.defaultProperties||{},{'tooltip':{'visible':false},'plotArea':{'colorPalette':['sapUiChartPaletteQualitativeHue1','sapUiChartPaletteQualitativeHue2','sapUiChartPaletteQualitativeHue3','sapUiChartPaletteQualitativeHue4','sapUiChartPaletteQualitativeHue5','sapUiChartPaletteQualitativeHue6','sapUiChartPaletteQualitativeHue7','sapUiChartPaletteQualitativeHue8','sapUiChartPaletteQualitativeHue9','sapUiChartPaletteQualitativeHue10','sapUiChartPaletteQualitativeHue11'],'primaryValuesColorPalette':['sapUiChartPaletteSequentialHue1Light1','sapUiChartPaletteSequentialHue1','sapUiChartPaletteSequentialHue1Dark1'],'secondaryValuesColorPalette':['sapUiChartPaletteSequentialHue2Light1','sapUiChartPaletteSequentialHue2','sapUiChartPaletteSequentialHue2Dark1'],'isFixedDataPointSize':true,'dataLabel':{'hideWhenOverlap':true,'respectShapeWidth':true,'style':{'color':null}},'dataPointSize':{'min':(sap.ui.Device.system.tablet||sap.ui.Device.system.phone)?48:24,'max':96}},'interaction':{'behaviorType':'sFinBehavior','selectability':{'mode':'multiple'}}});for(var t in v.controls.chart.specificProperties){var s=v.controls.chart.specificProperties[t];for(var k in s){if(s[k].gridline){s[k].gridline.visible=true}}}}}jQuery(this._app$).attr("data-sap-ui-preserve",true);var a=this._vizFrame=new V(this._vizFrame$.get(0),v);this._registerControl('sap.viz.controls.frame.VizFrame',this._vizFrame);a.vizOn('selectData',jQuery.proxy(function(e){this.fireEvent("selectData",e)},this));a.vizOn('deselectData',jQuery.proxy(function(e){this.fireEvent("deselectData",e)},this));a.vizOn('initialized',jQuery.proxy(function(e){this.fireEvent("renderComplete",e)},this));return a};
sap.viz.ui5.controls.VizFrame.prototype._updateVizFrame=function(){var o={'type':this._getVizType()};var d=this._getVizDataset();var f=this.getAggregation('feeds');if(d&&f){o.data=d;o.feeds=sap.viz.ui5.controls.common.helpers.VizControlsHelper.getFeedInstances(f)}if(this._requestedVizProperties){o.properties=this._requestedVizProperties}if(this._requestedVizScales){o.scales=this._requestedVizScales}o.properties=jQuery.extend(true,o.properties||{},sap.viz.ui5.theming.Util.readCSSParameters());if(!this._vizCreated){if(o.data&&o.feeds){this._vizCreated=true;this._vizFrame.createViz(o);this._clearRequestedProperties()}}else{this._vizFrame.vizUpdate(o);this._clearRequestedProperties()}if(d&&d.data()&&d.data().data.length===0){this._vizFrame.showMessage('')}};
sap.viz.ui5.controls.VizFrame.prototype._getVizDataset=function(){var d=this.getDataset();if(d){if(this._isExtension()){sap.viz.ui5.controls.common.helpers.VizControlsHelper.updateAxis(d.getDimensions(),this._getVizType(),this.getAggregation('feeds'));return d.getVIZDataset()}else{return d.getVIZFlatDataset()}}else{return null}};
sap.viz.ui5.controls.VizFrame.prototype._createChildren=function(){this._vizFrame$.appendTo(this._app$);this._updateVizFrame()};
sap.viz.ui5.controls.VizFrame.prototype._updateChildren=function(){this._updateVizFrame()};
sap.viz.ui5.controls.VizFrame.prototype._setFeeds=function(f){this.destroyFeeds();if(f&&f.length){for(var i=0;i<f.length;i++){this.addFeed(f[i])}}return this};
sap.viz.ui5.controls.VizFrame.prototype._applyTheme=function(){};
sap.viz.ui5.controls.VizFrame.prototype._validateSize=function(){if(!this._app$){return}var a={'width':this._app$.width(),'height':this._app$.height()};if(this._vizFrame){var s=this._vizFrame.size();if(!s||s.width!==a.width||s.height!==a.height){this._vizFrame.size({'width':a.width,'height':a.height})}}else{this._vizFrame$.css({'width':a.width+'px','height':a.height+'px'})}};
sap.viz.ui5.controls.VizFrame.prototype._isExtension=function(){return!sap.viz.ui5.controls.VizFrame._isNativeVizType(this._getVizType())};
sap.viz.ui5.controls.VizFrame._isNativeVizType=function(v){return jQuery.inArray(v,['info/column','info/bar','info/stacked_bar','info/stacked_column','info/line','info/combination','info/bullet','info/bubble','info/time_bubble',"info/pie","info/scatter","info/vertical_bullet","info/dual_stacked_bar","info/100_stacked_bar","info/100_dual_stacked_bar","info/dual_stacked_column","info/100_stacked_column","info/100_dual_stacked_column","info/stacked_combination","info/horizontal_stacked_combination","info/dual_stacked_combination","info/dual_horizontal_stacked_combination"])!==-1};
sap.viz.ui5.controls.VizFrame.prototype._mergeProperties=function(t,p){return jQuery.extend(true,t,p)};
