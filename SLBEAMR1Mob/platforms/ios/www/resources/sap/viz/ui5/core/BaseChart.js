/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.viz.ui5.core.BaseChart");jQuery.sap.require("sap.viz.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.viz.ui5.core.BaseChart",{metadata:{"abstract":true,library:"sap.viz",properties:{"width":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'640px'},"height":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'480px'},"css":{type:"string",group:"Appearance",defaultValue:null}},aggregations:{"dataset":{type:"sap.viz.ui5.data.Dataset",multiple:false},"noData":{type:"sap.ui.core.Control",multiple:false}},events:{"beforeCreateViz":{}}}});sap.viz.ui5.core.BaseChart.M_EVENTS={'beforeCreateViz':'beforeCreateViz'};jQuery.sap.require("sap.viz.libs.sap-viz");jQuery.sap.require("sap.viz.ui5.core.BaseStructuredType");jQuery.sap.require("sap.ui.core.theming.Parameters");
sap.viz.ui5.core.BaseChart.prototype._getSapVizCSS=function(){var c,C,s;var l=jQuery.sap.domById("sap-ui-theme-sap.viz");if(l){C=l.href;c=jQuery.sap.syncGetText(C+"?",undefined,undefined);if(!c){c=""}}if(this.getCss()){s=c+this.getCss()}return s};
sap.viz.ui5.core.BaseChart.prototype._getMergedChartOptions=function(){var u=this._getOptions();var g=sap.ui.core.theming.Parameters.get('sapVizChartAxisGridlineColor');var a=sap.ui.core.theming.Parameters.get('sapVizChartAxisColor');var c={xAxis:{gridline:{color:g}},yAxis:{gridline:{color:g}}};var b=this.getVIZChartType();switch(b){case"viz/dual_bar":c.yAxis.color=a;break;case"viz/dual_combination":case"viz/dual_line":case"viz/dual_stacked_column":case"viz/100_dual_stacked_column":case"viz/dual_column":c.xAxis.color=a;break;default:c.xAxis.color=a;c.yAxis.color=a;break}return jQuery.extend(true,c,u)};
sap.viz.ui5.core.BaseChart.prototype._unregisterListener=function(){if(this._sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sResizeListenerId);delete this._sResizeListenerId}};
sap.viz.ui5.core.BaseChart.prototype._registerListener=function(){this._sResizeListenerId=sap.ui.core.ResizeHandler.register(this.getDomRef(),jQuery.proxy(this.onresize,this))};
sap.viz.ui5.core.BaseChart.prototype._renderChart=function(){if(!sap.viz.__svg_support||!this.getDataset()||!this.getDataset().getVIZDataset()){return}if(this._oVIZInstance){this._oVIZInstance.destroy();delete this._oVIZInstance}var c=this._getSapVizCSS();var a=this._getMergedChartOptions();var u={type:this.getVIZChartType(),data:this.getDataset().getVIZDataset(),container:this.getDomRef(),options:a,css:c};this.fireBeforeCreateViz({usrOptions:u});this._oVIZInstance=sap.viz.core.createViz(u);var t=this;jQuery.sap.forIn(this._mVIZHandler,function(n,h){t._oVIZInstance.on(n+sap.viz.ui5.core.BaseChart.EVENT_SUFFIX,h)})};
sap.viz.ui5.core.BaseChart.prototype.init=function(){sap.viz._initializeVIZ();this._mVIZHandler={}};
sap.viz.ui5.core.BaseChart.prototype.exit=function(){this._unregisterListener();if(this._oVIZInstance){this._oVIZInstance.destroy();delete this._oVIZInstance}};
sap.viz.ui5.core.BaseChart.prototype.onBeforeRendering=function(){this._unregisterListener()};
sap.viz.ui5.core.BaseChart.prototype.onAfterRendering=function(){this._renderChart();this._registerListener()};
sap.viz.ui5.core.BaseChart.prototype.onresize=function(o){var s={width:this.$().width(),height:this.$().height()};if(this.getDomRef()&&this._oVIZInstance){this._oVIZInstance.size(s)}};
sap.viz.ui5.core.BaseChart.prototype.setDefaultSelection=function(s){var d=this.getDataset();if(d){var v=this.getDataset().getVIZDataset();if(v){v.info({'type':'defaultSelection','value':s});if(this._oVIZInstance){this._oVIZInstance.data(v)}}}};
sap.viz.ui5.core.BaseChart.prototype.onThemeChanged=function(o){if(!this.getDomRef()){return}this._renderChart()};
sap.viz.ui5.core.BaseChart.prototype.onLocalizationChanged=function(o){if(!this.getDomRef()){return}this._renderChart()};
sap.viz.ui5.core.BaseChart.prototype.validateAggregation=function(a,o,m){if(a==="interaction"){o=sap.viz.ui5.core.BaseStructuredType._convertAggregatedObject.call(this,a,o,m)}return sap.ui.core.Control.prototype.validateAggregation.call(this,a,o,m)};
sap.viz.ui5.core.BaseChart.EVENT_SUFFIX=".sap.viz.ui5.core";sap.viz.ui5.core.BaseChart.prototype._getOrCreate=sap.viz.ui5.core.BaseStructuredType.prototype._getOrCreate;sap.viz.ui5.core.BaseChart.prototype._getOptions=sap.viz.ui5.core.BaseStructuredType.prototype._getOptions;
sap.viz.ui5.core.BaseChart.prototype._attachVIZEvent=function(n,d,h,l){var t=this;if(!this.hasListeners(n)){this._mVIZHandler[n]=function(o){t.fireEvent(n,o)};if(this._oVIZInstance){this._oVIZInstance.on(n+sap.viz.ui5.core.BaseChart.EVENT_SUFFIX,this._mVIZHandler[n])}}sap.ui.core.Control.prototype.attachEvent.apply(this,arguments);return this};
sap.viz.ui5.core.BaseChart.prototype._detachVIZEvent=function(n,d,h,l){sap.ui.core.Control.prototype.detachEvent.apply(this,arguments);if(!this.hasListeners(n)){if(this._oVIZInstance){this._oVIZInstance.on(n+sap.viz.ui5.core.BaseChart.EVENT_SUFFIX,null)}delete this._mVIZHandler[n]}return this};
sap.viz.ui5.core.BaseChart.prototype.getVIZInstance=function(){return this._oVIZInstance||null};
sap.viz.ui5.core.BaseChart.prototype.selection=function(s,o){if(this._oVIZInstance){return this._oVIZInstance.selection.apply(this._oVIZInstance,arguments)}};
