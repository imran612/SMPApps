/*
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.viz.ui5.data.transformers.ModelToCrosstable');
sap.viz.ui5.data.transformers.ModelToCrosstable=function(){this.reset()};
sap.viz.ui5.data.transformers.ModelToCrosstable.prototype.reset=function(o){this._oVIZCrosstab=null;this._aCrossContextLookup=null};
sap.viz.ui5.data.transformers.ModelToCrosstable.prototype.getVizDataset=function(b,d,m,a,i){if(!this._oVIZCrosstab&&sap.viz.__svg_support){this._createVIZCrosstab(b,d,m,a,i)}return this._oVIZCrosstab||null};
sap.viz.ui5.data.transformers.ModelToCrosstable.prototype.findContext=function(c){if(this._aCrossContextLookup&&typeof c==='object'){return this._aCrossContextLookup[c.dii_a2]&&this._aCrossContextLookup[c.dii_a2][c.dii_a1]}};
sap.viz.ui5.data.transformers.ModelToCrosstable.prototype._createVIZCrosstab=function(b,a,m,c,e){var C=b&&b.getContexts(0,b.getLength());if(!C||C.length===0){this.reset();return}var A=[],f=[],M=[],g=[],h=[];jQuery.each(a,function(i,l){if(l.getAxis()===1){A.push({def:l,adapter:l._getAdapter()})}else if(l.getAxis()===2){f.push({def:l,adapter:l._getAdapter()})}else{throw new Error("currently, only axis 1 and 2 are supported")}});jQuery.each(m,function(i,l){M.push({def:l,adapter:l._getAdapter()});g.push([])});function k(t,u,w){var l=t.length,V,i;if(l===0){return 0}V=[];for(i=0;i<l;i++){V.push(t[i].adapter(w))}for(i=0,l=u.length;i<l;i++){if(jQuery.sap.equal(u[i],V)){return i}}u.push(V);return u.length-1}var n=[];var o=[];jQuery.each(C,function(I,l){var t=k(A,n,l);var u=k(f,o,l);for(var i=0;i<M.length;i++){var w=M[i].adapter(l);if(A.length===0&&f.length===0){if(g[i][0]===undefined){g[i][0]=[]}g[i][0].push(w)}else{(g[i][u]=(g[i][u]||[]))[t]=w}}if(A.length===0&&f.length===0){t=I}(h[u]||(h[u]=[]))[t]=l});var L=n.length;var p=Math.max(o.length,1);for(var j=0;j<p;j++){for(var i=0;i<M.length;i++){var d=g[i][j];if(!d){d=g[i][j]=[]}if(d.length<L){d[L-1]=undefined}}if(!h[j]){h[j]=[]}if(!h[j].length<L){h[j][L]=undefined}}var q={};if(A.length>0){if(q.analysisAxis===undefined){q.analysisAxis=[]}var r={index:1,data:[]};for(var i=0;i<A.length;i++){var v=[];for(var j=0;j<n.length;j++){v[j]=n[j][i]}r.data.push({name:A[i].def.getName(),values:v})}q.analysisAxis.push(r)}if(f.length>0){if(q.analysisAxis===undefined){q.analysisAxis=[]}var r={index:2,data:[]};for(var i=0;i<f.length;i++){var v=[];for(var j=0;j<o.length;j++){v[j]=o[j][i]}r.data.push({name:f[i].def.getName(),values:v})}q.analysisAxis.push(r)}if(M.length>0){q.measureValuesGroup=[];for(var i=0;i<M.length;i++){if(!q.measureValuesGroup[M[i].def.getGroup()-1]){q.measureValuesGroup[M[i].def.getGroup()-1]={index:M[i].def.getGroup(),data:[]}}q.measureValuesGroup[M[i].def.getGroup()-1].data.push({name:M[i].def.getName(),values:g[i]})}for(var i=0,s=q.measureValuesGroup.length;i<s;i++){if(q.measureValuesGroup[i]===undefined){throw new Error("Measure Group "+(i+1)+" is missing.");break}}}if(sap.viz.data){this._oVIZCrosstab=new sap.viz.data.CrosstableDataset();this._oVIZCrosstab.setData(q)}else{this._oVIZCrosstab=new sap.viz.api.data.CrosstableDataset();this._oVIZCrosstab.data(q)}if(c){this._oVIZCrosstab.info(c)}if(e){this._oVIZCrosstab.info(e)}this._aCrossContextLookup=h};
